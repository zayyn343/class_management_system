<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
        }

        .container-login {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        h4 {
            color: #333;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        input,
        select,
        textarea {
            width: calc(100% - 24px);
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background: #f9f9f9;
            transition: 0.3s;
            box-sizing: border-box;
            display: block;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #007bff;
            outline: none;
            background: #fff;
        }

        .btn-success {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            border-radius: 5px;
            width: calc(100% - 24px);
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-success:hover {
            background: #0056b3;
        }

        #studentDashboard,
        #adminDashboard,
        #teacherDashboard {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: auto;
            background-color: white;

        }

        header {
            background: #007bff;
            color: #fff;
            padding: 17px;
            text-align: center;
        }

        nav {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }

        nav ul {
            list-style: none;
            padding: 0;
        }

        nav ul li {
            display: inline;
            margin: 0 15px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
        }

        main {
            padding: 20px;
        }

        section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 14px 22px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            transition: background 0.3s, transform 0.2s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            display: inline-block;
            text-align: center;
            margin: 10px;
            min-width: 160px;
        }

        button:hover {
            background: #0056b3;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .dashboard {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            overflow: auto;
            background-color: white;
        }

        .sidebar {
            background: #333;
            color: white;
            padding: 20px;
            width: 250px;
            position: absolute;
            height: 150%;
            overflow: auto;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar li {
            margin-bottom: 10px;
        }

        .sidebar button {
            width: 100%;
            text-align: left;
            padding: 12px;
            margin: 5px 0;
        }

        .content {
            margin-left: 270px;
            padding: 20px;
        }

        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #007bff;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .present {
            color: green;
            font-weight: bold;
        }

        .absent {
            color: red;
            font-weight: bold;
        }

        #attendanceStatus {
            margin-top: 15px;
            font-weight: bold;
        }

        .form-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .empty-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        .student-filter {
            margin-bottom: 20px;
        }

        .success-message {
            color: green;
            font-weight: bold;
            margin-top: 10px;
        }

        .meeting-generator {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }

        .meetings-list table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .meetings-list th {
            background: #007bff;
            color: white;
            padding: 12px;
        }

        .meetings-list td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>

<body>
    <!-- Login Page -->
    <div class="container">
        <div class="container-login" id="loginPage">
            <h1 class="h4 text-gray-900 mb-4">Login</h1>
            <form class="user" id="loginForm">
                <div class="form-group">
                    <select required name="userType" class="form-group mb-3">
                        <option value="">Select User Roles</option>
                        <option value="Administrator">Administrator</option>
                        <option value="ClassTeacher">Class Teacher</option>
                        <option value="Student">Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="text" class="form-group" required name="username" id="username"
                        placeholder="Enter Email Address">
                </div>
                <div class="form-group">
                    <input type="password" name="password" required class="form-group" id="password"
                        placeholder="Enter Password">
                </div>
                <div class="form-group">
                    <input type="submit" class="btn btn-success btn-block" value="Login" />
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboards -->
    <div id="studentDashboard" class="dashboard">
        <header>
            <h1>Student Dashboard</h1>
        </header>
        <div class="sidebar">
            <ul>
                <li><button onclick="showSection('schedule')">Class Schedule</button></li>
                <li><button onclick="showSection('assignments')">Assignments</button></li>
                <li><button onclick="showSection('attendance')">Attendance</button></li>
                <li><button onclick="showSection('leave')">Apply for Leave</button></li>
                <li><button onclick="showSection('uploadedLectures')">Uploaded Lectures</button></li>
                <li><button onclick="logout()">Logout</button></li>
            </ul>
        </div>
        <div class="content">
            <div id="uploadedLectures" class="section" style="display: none;">
                <h2>Uploaded Lectures</h2>
                <div class="form-group">
                    <label for="studentLectureCourseSelect">Select Course:</label>
                    <select id="studentLectureCourseSelect" class="form-group mb-3">
                        <option value="">Select Course</option>
                        <option value="Web Development">Web Development</option>
                        <option value="Graphic Designing">Graphic Designing</option>
                        <option value="E-commerce">E-commerce</option>
                    </select>
                </div>
                <div id="studentLecturesList"></div>
            </div>


            <div id="schedule" class="section" style="display: none;">
                <h2>Class Schedule</h2>
                <div class="form-group">
                    <label for="courseSelect">Select Course:</label>
                    <select id="courseSelect" class="form-group mb-3">
                        <option value="">Select Course</option>
                        <option value="Web Development">Web Development</option>
                        <option value="Graphic Designing">Graphic Designing</option>
                        <option value="E-commerce">E-commerce</option>
                    </select>
                </div>
                <ul id="classList"></ul>
            </div>
            <div id="assignments" class="section" style="display: none;">
                <h2>Assignments</h2>
                <form id="assignmentForm">
                    <label for="assignment">Upload Assignment:</label>
                    <input type="file" id="assignment" required>
                    <button type="submit">Submit</button>
                </form>
                <p id="uploadStatus"></p>
            </div>
            <div id="attendance" class="section" style="display: block;">
                <h2>Mark Attendance</h2>
                <p>You must mark your attendance before 10:00 AM to be considered present.</p>
                <p id="attendanceStatus"></p>
                <button id="markAttendance">Mark Attendance</button>
                <div id="attendanceTableContainer" style="display: none;">
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceBody"></tbody>
                    </table>
                </div>
            </div>
            <div id="leave" class="section" style="display: none;">
                <h2>Apply for Leave</h2>
                <form id="leaveForm">
                    <label for="leaveReason">Reason for Leave:</label>
                    <input type="text" id="leaveReason" required>
                    <label for="leaveDate">Date:</label>
                    <input type="date" id="leaveDate" required>
                    <button type="submit">Submit Leave Request</button>
                </form>
                <p id="leaveStatus"></p>
            </div>
        </div>
    </div>
    <div id="adminDashboard" class="dashboard">
        <header>
            <h1>Admin Dashboard</h1>
        </header>
        <div class="dashboard-container" style="display: flex;">
            <div class="sidebar">
                <ul>
                    <li><button onclick="showAdminSection('userManagement')">User Management</button></li>
                    <li><button onclick="showAdminSection('adminAttendance')">Attendance Tracking</button></li>
                    <li><button onclick="showAdminSection('meetings')">Meeting Management</button></li>
                    <li><button onclick="showAdminSection('lectures')">Recorded Lectures</button></li>
                    <li><button onclick="showAdminSection('assignments')">Assignment Tracking</button></li>
                    <li><button onclick="showAdminSection('notifications')">Notifications</button></li>
                    <li><button onclick="showAdminSection('courses')">Course Management</button></li>
                    <li><button onclick="logout()">Logout</button></li>
                </ul>
            </div>
            <div class="content" style="flex: 1; padding: 20px; margin-left: 20px; height: 100vh; overflow-y: auto;">
                <div id="userManagement" class="admin-section" style="display: none;">
                    <h2>User Management</h2>
                    <div class="button-group">
                        <button>Add User</button>
                        <button>Remove User</button>
                        <button>View Users</button>
                    </div>
                </div>
                <div id="adminAttendance" class="admin-section" style="display: none;">
                    <h2>Attendance Tracking & Reporting</h2>
                    <div class="button-group">
                        <button>View Attendance Reports</button>
                        <button>Export Attendance Data</button>
                    </div>
                </div>
                <div id="meetings" class="admin-section" style="display: none;">
                    <h2>Meeting Management</h2>
                    <div class="button-group">
                        <button>Monitor Active Classes</button>
                        <button>End Meeting</button>
                    </div>
                </div>
                <div id="lectures" class="admin-section" style="display: none;">
                    <h2>Recorded Lecture Management</h2>
                    <div class="button-group">
                        <button>Uploaded Lecture</button>
                        <button>Delete Old Recordings</button>
                    </div>
                </div>
                <div id="assignments" class="admin-section" style="display: none;">
                    <h2>Assignment Tracking</h2>
                    <div class="button-group">
                        <button>View Submissions</button>
                        <button>Check Performance Analytics</button>
                    </div>
                </div>
                <div id="notifications" class="admin-section" style="display: none;">
                    <h2>Notifications & Announcements</h2>
                    <div class="button-group">
                        <button>Send System-Wide Notification</button>
                        <button>Manage Alerts</button>
                    </div>
                </div>
                <div id="courses" class="admin-section" style="display: none;">
                    <h2>Course & Syllabus Management</h2>
                    <div class="button-group">
                        <button>Add Course</button>
                        <button>Update Syllabus</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="teacherDashboard" class="dashboard">
        <header>
            <h1>Teacher Dashboard</h1>
        </header>
        <div class="sidebar">
            <ul>
                <li><button onclick="showSection('attendance')">Attendance Management</button></li>
                <li><button onclick="showSection('meetings')">Meeting Link Generation</button></li>
                <li><button onclick="showSection('lectures')">Lecture Uploads</button></li>
                <li><button onclick="showSection('assignments')">Assignment Management</button></li>
                <li><button onclick="showSection('notifications')">Notifications & Announcements</button></li>
                <li><button onclick="logout()">Logout</button></li>
            </ul>
        </div>
        <div class="content">
            <div id="attendance" class="section" style="display: none;">
                <h2>Attendance Management</h2>
                <div class="student-filter">
                    <label for="attendanceDate">Filter by Date:</label>
                    <input type="date" id="attendanceDate">
                    <button id="filterAttendance">Filter</button>
                    <button id="reviewAllAttendance">View All Records</button>
                </div>
                <div id="teacherAttendanceTableContainer">
                    <table id="teacherAttendanceTable">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="teacherAttendanceBody"></tbody>
                    </table>
                    <div id="noAttendanceData" class="empty-message" style="display: none;">
                        No attendance records found. Students may not have marked their attendance yet.
                    </div>
                </div>
            </div>
            <div id="meetings" class="section" style="display: none;">
                <h2>Meeting Link Generation</h2>
                <div class="meetings"
                    style="max-width: 500px; margin: auto; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); background-color: #ffffff;">
                    <h3>Meeting Link Generator</h3>
                    <div class="form-group">
                        <label for="meetingTitle">Meeting Title:</label>
                        <select id="meetingTitle" required>
                            <option value="">Select Course</option>
                            <option value="Web Development">Web Development</option>
                            <option value="Graphic Designing">Graphic Designing</option>
                            <option value="E-commerce">E-commerce</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="meetingDate">Date:</label>
                        <input type="date" id="meetingDate" required>
                    </div>
                    <div class="form-group">
                        <label for="meetingTime">Time:</label>
                        <input type="time" id="meetingTime" required>
                    </div>
                    <button onclick="generateMeetingLink()" class="btn-success">Generate Meeting Link</button>
                </div>
                <div id="meetingLinkResult" class="meeting-link-result" style="display: none; margin-top: 20px;">
                    <h3>Your Meeting Link</h3>
                    <p>Your meeting link has been generated:</p>
                    <div id="generatedLink" class="generated-link" style="font-weight: bold; color: #007bff;"></div>
                    <button onclick="copyMeetingLink()" class="btn-success">Copy Link</button>
                    <button onclick="joinMeeting()" class="btn-success">Join Now</button>
                </div>
                <div class="meetings-list" style="margin-top: 30px;">
                    <h2>Your Scheduled Meetings</h2>
                    <div id="meetingsList"></div>
                </div>
            </div>
            <div id="lectures" class="section" style="display: none;">
                <h2>Lecture Uploads</h2>
                <p>Upload recorded lectures for your students to review.</p>
                <div class="form-container">
                    <form id="lectureUploadForm">
                        <div class="form-group">
                            <label for="lectureCourse">Select Course:</label>
                            <select id="lectureCourse" required>
                                <option value="">Select Course</option>
                                <option value="Web Development">Web Development</option>
                                <option value="Graphic Designing">Graphic Designing</option>
                                <option value="E-commerce">E-commerce</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="lectureTitle">Lecture Title:</label>
                            <input type="text" id="lectureTitle" required placeholder="Enter lecture title">
                        </div>
                        <div class="form-group">
                            <label for="lectureDescription">Description:</label>
                            <textarea id="lectureDescription" placeholder="Enter lecture description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="lectureFile">Upload Recorded Lecture:</label>
                            <input type="file" id="lectureFile" required>
                        </div>
                        <button type="submit">Upload Lecture</button>
                    </form>
                </div>
                <p id="lectureUploadStatus" class="success-message"></p>
                <div id="uploadedLectures">
                    <h3>Uploaded Lectures</h3>
                    <ul id="lectureList"></ul>
                </div>
            </div>
            <div id="assignments" class="section" style="display: none;">
                <h2>Assignment Management</h2>
                <p>Create and manage assignments for your students.</p>
                <button id="createAssignment">Create New Assignment</button>
                <div id="assignmentFormContainer"></div>
                <div id="existingAssignments">
                    <h3>Existing Assignments</h3>
                    <table id="assignmentsTable">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="assignmentsBody"></tbody>
                    </table>
                    <div id="noAssignmentsMessage" class="empty-message" style="display: none;">
                        No assignments created yet. Use the "Create New Assignment" button to get started.
                    </div>
                </div>
            </div>
            <div id="notifications" class="section" style="display: none;">
                <h2>Notifications & Announcements</h2>
                <p>Send important announcements to your students.</p>
                <div class="form-container">
                    <form id="announcementForm">
                        <div class="form-group">
                            <label for="announcementTitle">Announcement Title:</label>
                            <input type="text" id="announcementTitle" required placeholder="Enter announcement title">
                        </div>
                        <div class="form-group">
                            <label for="announcementText">Announcement Text:</label>
                            <textarea id="announcementText" required placeholder="Enter your announcement"></textarea>
                        </div>
                        <button type="submit">Send Announcement</button>
                    </form>
                </div>
                <p id="announcementStatus" class="success-message"></p>
                <div id="sentAnnouncements">
                    <h3>Sent Announcements</h3>
                    <ul id="announcementList"></ul>
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    // Date and time update function
    document.addEventListener("DOMContentLoaded", function () {
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleDateString() + " - " +
                now.toLocaleTimeString() + " (" + now.toLocaleDateString(undefined, { weekday: 'long' }) + ")";

            document.querySelectorAll("header h1").forEach(header => {
                let extraSpan = header.querySelector(".datetime");
                if (!extraSpan) {
                    extraSpan = document.createElement("span");
                    extraSpan.classList.add("datetime");
                    extraSpan.style.display = "block";
                    extraSpan.style.fontSize = "16px";
                    extraSpan.style.marginTop = "5px";
                    header.appendChild(extraSpan);
                }
                extraSpan.textContent = dateTimeString;
            });
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);
    });

    function showAdminSection(sectionId) {
            // Hide all admin sections
            const adminSections = document.querySelectorAll('.admin-section');
            adminSections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            } else {
                console.error(`Admin section with ID "${sectionId}" not found. Available sections:`);
                adminSections.forEach(section => console.log(section.id));
            }
        }

    document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("loginForm");
        const loginPage = document.getElementById("loginPage");
        const dashboards = {
            Student: document.getElementById("studentDashboard"),
            Administrator: document.getElementById("adminDashboard"),
            ClassTeacher: document.getElementById("teacherDashboard")
        };

        // Predefined user credentials
        const users = {
            Administrator: { username: "admin@example.com", password: "admin123" },
            Student: { username: "student@example.com", password: "student123" },
            ClassTeacher: { username: "teacher@example.com", password: "teacher123" }
        };


        // Handle login form submission
        loginForm.addEventListener("submit", function (event) {
            event.preventDefault();
            const userType = document.querySelector("select[name='userType']").value;
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            // Validate credentials
            if (users[userType] && users[userType].username === username && users[userType].password === password) {
                loginPage.style.display = "none";
                Object.values(dashboards).forEach(dashboard => dashboard.style.display = "none");
                dashboards[userType].style.display = "block";

                // Save current user type to session storage
                sessionStorage.setItem('currentUserType', userType); // Fixed: removed space in key name
                sessionStorage.setItem('currentUsername', username);

                // If it's a student login, check if attendance needs to be marked
                if (userType === "Student") {
                    checkAttendanceStatus();
                } else if (userType === "ClassTeacher") {
                    // Show default section for teacher
                    showSection('attendance');
                    initializeTeacherDashboard();
                } else {
                }
            } else {
                alert("Invalid credentials. Please try again.");
            }
        });

        // Function to show the selected section
        window.showSection = function (sectionId) {
            // Get all sections in the current dashboard
            const currentUserType = sessionStorage.getItem('currentUserType');
            let currentDashboard;

            if (currentUserType === "Student") {
                currentDashboard = document.getElementById("studentDashboard");
            } else if (currentUserType === "ClassTeacher") {
                currentDashboard = document.getElementById("teacherDashboard");
            } else if (currentUserType === "Administrator") {
                currentDashboard = document.getElementById("adminDashboard");
            }

            if (!currentDashboard) return;

            // Hide all sections in the current dashboard
            const sections = currentDashboard.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected section
            const targetSection = currentDashboard.querySelector(`#${sectionId}`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Handle specific functionality based on section and dashboard
            if (currentUserType === "Student") {
                if (sectionId === 'attendance') {
                    checkAttendanceStatus();
                    loadAttendanceRecords();
                } else if (sectionId === 'schedule') {
                    loadClassSchedule();
                } else if (sectionId === 'uploadedLectures') {
                    // Reset the course selection when the section is shown
                    const studentLectureCourseSelect = document.getElementById('studentLectureCourseSelect');
                    if (studentLectureCourseSelect) {
                        studentLectureCourseSelect.value = '';
                        document.getElementById('studentLecturesList').innerHTML = '<p>Please select a course to view lectures.</p>';
                    }
                }
            }
        };

        // Function to send announcement
        function sendAnnouncement(event) {
            event.preventDefault();

            const title = document.getElementById('announcementTitle').value;
            const text = document.getElementById('announcementText').value;
            const announcementStatus = document.getElementById('announcementStatus');

            if (!title || !text) {
                alert('Please fill in all fields.');
                return;
            }

            // Store announcement in localStorage
            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `announcements_${username}`;
            const announcements = JSON.parse(localStorage.getItem(storageKey)) || [];

            announcements.push({
                title,
                text,
                sentOn: new Date().toISOString()
            });

            localStorage.setItem(storageKey, JSON.stringify(announcements));

            // Update status
            if (announcementStatus) {
                announcementStatus.textContent = `Announcement "${title}" sent successfully.`;
                setTimeout(() => {
                    announcementStatus.textContent = '';
                }, 3000);
            }

            // Reset form
            document.getElementById('announcementForm').reset();

            // Refresh the announcements list
            loadSentAnnouncements();
        }

        // Function to load sent announcements
        function loadSentAnnouncements() {
            const announcementList = document.getElementById('announcementList');
            if (!announcementList) return;

            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `announcements_${username}`;
            const announcements = JSON.parse(localStorage.getItem(storageKey)) || [];

            if (announcements.length === 0) {
                announcementList.innerHTML = '<li class="empty-message">No announcements sent yet.</li>';
                return;
            }

            // Sort announcements by date (newest first)
            announcements.sort((a, b) => new Date(b.sentOn) - new Date(a.sentOn));

            announcementList.innerHTML = '';
            announcements.forEach(announcement => {
                const sentDate = new Date(announcement.sentOn).toLocaleDateString();
                const li = document.createElement('li');
                li.style.padding = '10px';
                li.style.margin = '10px 0';
                li.style.backgroundColor = '#f9f9f9';
                li.style.borderRadius = '5px';
                li.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';

                li.innerHTML = `
                    <strong>${announcement.title}</strong>
                    <p>${announcement.text}</p>
                    <p><small>Sent on ${sentDate}</small></p>
                `;

                announcementList.appendChild(li);
            });
        }

        // Function to show admin dashboard sections
        



        // Function to handle logout

        window.logout = function () {
            alert('You have been logged out.');
            // Clear session storage
            sessionStorage.removeItem('currentUserType'); // Fixed: removed space in key name
            sessionStorage.removeItem('currentUsername');

            // Show login page and hide dashboards
            document.getElementById("loginPage").style.display = "flex";
            document.querySelectorAll('.dashboard').forEach(dashboard => {
                dashboard.style.display = "none";
            });
        }


        // Initialize the attendance functionality
        function initializeAttendance() {
            const markAttendanceBtn = document.getElementById('markAttendance');
            if (markAttendanceBtn) {
                markAttendanceBtn.addEventListener('click', markAttendance);
            }


            // Initialize leave form
            const leaveForm = document.getElementById('leaveForm');
            if (leaveForm) {
                leaveForm.addEventListener('submit', submitLeaveRequest);
            }

            // Check attendance status when the page loads
            checkAttendanceStatus();
        }

        // Function to check if attendance needs to be marked
        function checkAttendanceStatus() {
            // Only check attendance for students
            const currentUserType = sessionStorage.getItem('currentUserType');
            if (currentUserType !== "Student") return;

            const today = new Date();
            const currentDate = today.toLocaleDateString();
            const attendanceRecords = getAttendanceRecords();
            const attendanceStatus = document.getElementById('attendanceStatus');
            const markAttendanceBtn = document.getElementById('markAttendance');

            // Check if attendance is already marked for today
            const todayRecord = attendanceRecords.find(record => record.date === currentDate);

            if (attendanceStatus) {
                if (todayRecord) {
                    attendanceStatus.textContent = `Your attendance for today (${currentDate}) is marked as "${todayRecord.status}".`;
                    attendanceStatus.className = todayRecord.status.toLowerCase();

                    // Disable the mark attendance button if already marked
                    if (markAttendanceBtn) {
                        markAttendanceBtn.disabled = true;
                        markAttendanceBtn.textContent = "Attendance Already Marked";
                    }
                } else {
                    const currentHour = today.getHours();

                    // Automatic absent marking after 10 AM
                    if (currentHour >= 10) {
                        markAbsent();
                        if (markAttendanceBtn) {
                            markAttendanceBtn.disabled = true;
                            markAttendanceBtn.textContent = "Attendance Marked as Absent (After 10 AM)";
                        }
                    } else {
                        attendanceStatus.textContent = "Please mark your attendance for today before 10:00 AM.";
                        attendanceStatus.className = "";

                        if (markAttendanceBtn) {
                            markAttendanceBtn.disabled = false;
                            markAttendanceBtn.textContent = "Mark Attendance";
                        }
                    }
                }
            }
        }

        // Function to get attendance records from localStorage
        function getAttendanceRecords() {
            const username = sessionStorage.getItem('currentUsername') || 'student@example.com';
            const storageKey = `attendanceRecords_${username}`;
            return JSON.parse(localStorage.getItem(storageKey)) || [];
        }

        // Function to mark attendance
        function markAttendance() {
            const today = new Date();
            const date = today.toLocaleDateString();
            const day = today.toLocaleString('en-US', { weekday: 'long' });
            const time = today.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const username = sessionStorage.getItem('currentUsername') || 'student@example.com';
            const storageKey = `attendanceRecords_${username}`;

            // Get attendance records
            const attendanceRecords = JSON.parse(localStorage.getItem(storageKey)) || [];

            // Check if attendance is already marked for today
            const todayRecord = attendanceRecords.find(record => record.date === date);

            if (!todayRecord) {
                // Create new attendance record
                const record = { date, day, time, status: 'Present' };
                attendanceRecords.push(record);
                localStorage.setItem(storageKey, JSON.stringify(attendanceRecords));

                // Show the attendance table
                const attendanceTableContainer = document.getElementById('attendanceTableContainer');
                if (attendanceTableContainer) {
                    attendanceTableContainer.style.display = 'block';
                }

                // Update attendance status
                const attendanceStatus = document.getElementById('attendanceStatus');
                if (attendanceStatus) {
                    attendanceStatus.textContent = `Your attendance for today (${date}) is marked as "Present".`;
                    attendanceStatus.className = "present";
                }

                // Disable the mark attendance button
                const markAttendanceBtn = document.getElementById('markAttendance');
                if (markAttendanceBtn) {
                    markAttendanceBtn.disabled = true;
                    markAttendanceBtn.textContent = "Attendance Already Marked";
                }

                // Load the updated attendance records
                loadAttendanceRecords();
            }
        }

        // Function to mark student as absent (automatically called after 10 AM)
        function markAbsent() {
            // Only mark absent for students
            const currentUserType = sessionStorage.getItem('currentUserType');
            if (currentUserType !== "Student") return;

            const today = new Date();
            const date = today.toLocaleDateString();
            const day = today.toLocaleString('en-US', { weekday: 'long' });
            const time = today.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const username = sessionStorage.getItem('currentUsername') || 'student@example.com';
            const storageKey = `attendanceRecords_${username}`;

            // Get attendance records
            const attendanceRecords = JSON.parse(localStorage.getItem(storageKey)) || [];

            // Check if attendance is already marked for today
            const todayRecord = attendanceRecords.find(record => record.date === date);

            if (!todayRecord) {
                // Create new attendance record with absent status
                const record = { date, day, time, status: 'Absent' };
                attendanceRecords.push(record);
                localStorage.setItem(storageKey, JSON.stringify(attendanceRecords));

                // Update attendance status
                const attendanceStatus = document.getElementById('attendanceStatus');
                if (attendanceStatus) {
                    attendanceStatus.textContent = `Your attendance for today (${date}) is automatically marked as "Absent" (after 10:00 AM).`;
                    attendanceStatus.className = "absent";
                }

                // Load the updated attendance records
                loadAttendanceRecords();
            }
        }

        // Function to load attendance records into table
        function loadAttendanceRecords() {
            const attendanceBody = document.getElementById('attendanceBody');
            const attendanceTableContainer = document.getElementById('attendanceTableContainer');

            if (!attendanceBody || !attendanceTableContainer) return;

            const attendanceRecords = getAttendanceRecords();

            if (attendanceRecords.length > 0) {
                attendanceTableContainer.style.display = 'block';
                attendanceBody.innerHTML = '';

                // Sort records by date (newest first)
                attendanceRecords.sort((a, b) => {
                    return new Date(b.date) - new Date(a.date);
                });

                // Populate table with records
                attendanceRecords.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${record.date}</td>
                <td>${record.day}</td>
                <td>${record.time}</td>
                <td class="${record.status.toLowerCase()}">${record.status}</td>
            `;
                    attendanceBody.appendChild(row);
                });
            } else {
                attendanceTableContainer.style.display = 'none';
            }
        }



        // Function to submit leave request
        function submitLeaveRequest(event) {
            event.preventDefault();
            const leaveReason = document.getElementById('leaveReason');
            const leaveDate = document.getElementById('leaveDate');
            const leaveStatus = document.getElementById('leaveStatus');

            if (leaveReason && leaveDate && leaveStatus) {
                const reason = leaveReason.value;
                const date = leaveDate.value;

                if (reason && date) {
                    // Store leave request in localStorage
                    const username = sessionStorage.getItem('currentUsername') || 'student@example.com';
                    const storageKey = `leaveRequests_${username}`;
                    const leaveRequests = JSON.parse(localStorage.getItem(storageKey)) || [];

                    leaveRequests.push({
                        reason,
                        date,
                        status: 'Pending',
                        submittedOn: new Date().toLocaleDateString()
                    });

                    localStorage.setItem(storageKey, JSON.stringify(leaveRequests));

                    // Update status
                    leaveStatus.textContent = `Leave request for ${new Date(date).toLocaleDateString()} submitted successfully.`;
                    leaveStatus.style.color = 'green';

                    // Reset form
                    event.target.reset();
                } else {
                    leaveStatus.textContent = "Please fill in all fields.";
                    leaveStatus.style.color = 'red';
                }
            }
        }

        // Initialize Teacher Dashboard functionality
        function initializeTeacherDashboard() {
            // Set up event listeners for teacher dashboard
            const filterAttendanceBtn = document.getElementById('filterAttendance');
            if (filterAttendanceBtn) {
                filterAttendanceBtn.addEventListener('click', filterAttendanceByDate);
            }

            const reviewAllAttendanceBtn = document.getElementById('reviewAllAttendance');
            if (reviewAllAttendanceBtn) {
                reviewAllAttendanceBtn.addEventListener('click', loadAllStudentsAttendance);
            }

            const generateMeetingLinkBtn = document.getElementById('generateMeetingLink');
            if (generateMeetingLinkBtn) {
                generateMeetingLinkBtn.addEventListener('click', generateMeetingLink);
            }

            const copyLinkBtn = document.getElementById('copyLink');
            if (copyLinkBtn) {
                copyLinkBtn.addEventListener('click', copyMeetingLink);
            }

            const lectureUploadForm = document.getElementById('lectureUploadForm');
            if (lectureUploadForm) {
                lectureUploadForm.addEventListener('submit', uploadLecture);
            }

            const createAssignmentBtn = document.getElementById('createAssignment');
            if (createAssignmentBtn) {
                createAssignmentBtn.addEventListener('click', showAssignmentForm);
            }

            const announcementForm = document.getElementById('announcementForm');
            if (announcementForm) {
                announcementForm.addEventListener('submit', sendAnnouncement);
            }
        }



        // Load meetings when page loads
        //document.addEventListener('DOMContentLoaded', loadMeetings);

        // Function to generate a real meeting link using Jitsi Meet
        function generateMeetingLink() {
            const meetingTitle = document.getElementById('meetingTitle');
            const meetingDate = document.getElementById('meetingDate');
            const meetingTime = document.getElementById('meetingTime');
            const meetingLinkResult = document.getElementById('meetingLinkResult');
            const generatedLink = document.getElementById('generatedLink');

            if (!meetingTitle || !meetingDate || !meetingTime || !meetingLinkResult || !generatedLink) return;

            const title = meetingTitle.value.trim();
            const date = meetingDate.value;
            const time = meetingTime.value;

            if (!title || !date || !time) {
                alert('Please fill in all fields to generate a meeting link.');
                return;
            }

            // Generate a sanitized room name from the title
            const roomName = title.replace(/[^a-zA-Z0-9]/g, '').toLowerCase() + '_' + Date.now().toString(36);
            const link = `https://meet.jit.si/${roomName}`;

            // Store meeting in localStorage for the teacher
            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `meetings_${username}`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            meetings.push({
                title,
                date,
                time,
                link,
                created: new Date().toLocaleString()
            });

            localStorage.setItem(storageKey, JSON.stringify(meetings));

            // Also store the meeting for students to access
            const studentStorageKey = `meetings_for_students`;
            const studentMeetings = JSON.parse(localStorage.getItem(studentStorageKey)) || [];

            studentMeetings.push({
                title,
                date,
                time,
                link,
                created: new Date().toLocaleString()
            });

            localStorage.setItem(studentStorageKey, JSON.stringify(studentMeetings));

            // Display the generated link
            generatedLink.textContent = link;
            meetingLinkResult.style.display = 'block';

            // Refresh the meetings list
            loadMeetings();
        }

        // Function to load and display saved meetings
        function loadMeetings() {
            const meetingsListElement = document.getElementById('meetingsList');
            if (!meetingsListElement) return;

            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `meetings_${username}`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            if (meetings.length === 0) {
                meetingsListElement.innerHTML = '<p class="no-meetings">No meetings scheduled yet.</p>';
                return;
            }

            // Sort meetings by date and time
            meetings.sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}`);
                const dateB = new Date(`${b.date}T${b.time}`);
                return dateA - dateB;
            });

            // Create table to display meetings
            let tableHTML = `
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
    `;

            meetings.forEach((meeting, index) => {
                const meetingDate = new Date(`${meeting.date}T${meeting.time}`);
                const formattedDate = meetingDate.toLocaleDateString();
                const formattedTime = meetingDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                tableHTML += `
            <tr>
                <td>${meeting.title}</td>
                <td>${formattedDate}</td>
                <td>${formattedTime}</td>
                <td>
                    <button onclick="copyMeetingLinkFromList(${index})">Copy Link</button>
                    <button onclick="joinMeetingFromList(${index})">Join</button>
                    <button onclick="deleteMeeting(${index})">Delete</button>
                </td>
            </tr>
        `;
            });

            tableHTML += `
            </tbody>
        </table>
    `;

            meetingsListElement.innerHTML = tableHTML;
        }

        // Function to copy a meeting link from the list
        function copyMeetingLinkFromList(index) {
            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `meetings_${username}`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            if (index >= 0 && index < meetings.length) {
                const link = meetings[index].link;

                if (navigator.clipboard) {
                    navigator.clipboard.writeText(link)
                        .then(() => {
                            alert('Meeting link copied to clipboard!');
                        })
                        .catch(err => {
                            console.error('Failed to copy link: ', err);
                            alert('Failed to copy link. Please select and copy manually.');
                        });
                } else {
                    // Fallback method for older browsers
                    const tempInput = document.createElement('input');
                    tempInput.value = link;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    alert('Meeting link copied to clipboard!');
                }
            }
        }

        // Function to join a meeting from the list
        function joinMeetingFromList(index) {
            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `meetings_${username}`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            if (index >= 0 && index < meetings.length) {
                const link = meetings[index].link;
                window.open(link, '_blank');
            }
        }

        // Function to delete a meeting
        function deleteMeeting(index) {
            if (!confirm('Are you sure you want to delete this meeting?')) return;

            const username = sessionStorage.getItem('currentUsername') || 'teacher@example.com';
            const storageKey = `meetings_${username}`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            if (index >= 0 && index < meetings.length) {
                // Get the meeting details
                const meetingToDelete = meetings[index];

                // Remove from teacher's meetings
                meetings.splice(index, 1);
                localStorage.setItem(storageKey, JSON.stringify(meetings));

                // Also remove from student's view
                const studentStorageKey = `meetings_for_students`;
                const studentMeetings = JSON.parse(localStorage.getItem(studentStorageKey)) || [];

                // Find and remove the meeting with the same link
                const studentMeetingIndex = studentMeetings.findIndex(m => m.link === meetingToDelete.link);
                if (studentMeetingIndex !== -1) {
                    studentMeetings.splice(studentMeetingIndex, 1);
                    localStorage.setItem(studentStorageKey, JSON.stringify(studentMeetings));
                }

                loadMeetings();
            }
        }

        // Function to load class schedule for students
        // Event listener for course selection
        document.getElementById('courseSelect').addEventListener('change', function () {
            const selectedCourse = this.value;
            loadClassSchedule(selectedCourse);
        });

        function loadClassSchedule(selectedCourse = null) {
            const classList = document.getElementById('classList');
            if (!classList) return;

            // Retrieve meetings from localStorage
            const storageKey = `meetings_for_students`;
            const meetings = JSON.parse(localStorage.getItem(storageKey)) || [];

            // Filter meetings by selected course if provided
            const filteredMeetings = selectedCourse ?
                meetings.filter(meeting => meeting.title === selectedCourse) :
                meetings;

            classList.innerHTML = ''; // Clear existing content

            if (filteredMeetings.length > 0) {
                // Sort meetings by date and time
                filteredMeetings.sort((a, b) => {
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });

                filteredMeetings.forEach((meeting) => {
                    const meetingDate = new Date(`${meeting.date}T${meeting.time}`);
                    const formattedDate = meetingDate.toLocaleDateString();
                    const formattedTime = meetingDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    const li = document.createElement('li');
                    li.className = 'class-item';
                    li.style.margin = '10px 0';
                    li.style.padding = '15px';
                    li.style.borderRadius = '8px';
                    li.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                    li.style.backgroundColor = '#f9f9f9';

                    li.innerHTML = `
        <strong>${meeting.title}</strong> 
        <span style="color: #666;">(${formattedDate} at ${formattedTime})</span>
        <p style="margin-top: 8px;">Meeting Link: 
            <a href="${meeting.link}" target="_blank" style="color: #0078d7; text-decoration: underline;">
                ${meeting.link.substring(0, 30)}...
            </a>
        </p>
        <button onclick="joinClass('${meeting.link}')" 
            style="margin-top: 8px; padding: 8px 15px; background-color: #007bff; color: white; 
            border: none; border-radius: 4px; cursor: pointer;">
            Join Now
        </button>
    `;

                    classList.appendChild(li);
                });
            } else {
                if (selectedCourse) {
                    classList.innerHTML = '<li class="empty-message" style="padding: 15px; text-align: center; color: #666;">No classes scheduled for this course.</li>';
                } else {
                    classList.innerHTML = '<li class="empty-message" style="padding: 15px; text-align: center; color: #666;">No classes scheduled yet.</li>';
                }
            }
        }

        // Function for student to join class
        function joinClass(link) {
            window.open(link, '_blank');
        }

        // Function to copy meeting link to clipboard
        function copyMeetingLink() {
            const generatedLink = document.getElementById('generatedLink');

            if (!generatedLink) return;

            const link = generatedLink.textContent;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(link)
                    .then(() => {
                        alert('Meeting link copied to clipboard!');
                    })
                    .catch(err => {
                        console.error('Failed to copy link: ', err);
                        alert('Failed to copy link. Please select and copy manually.');
                    });
            } else {
                // Fallback method for older browsers
                const tempInput = document.createElement('input');
                tempInput.value = link;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('Meeting link copied to clipboard!');
            }
        }

        // Function to join the meeting directly
        function joinMeeting() {
            const generatedLink = document.getElementById('generatedLink');

            if (!generatedLink) return;

            const link = generatedLink.textContent;
            window.open(link, '_blank');
        }

        // Function to get all students' attendance records
        function getAllStudentsAttendanceRecords() {
            const studentUsernames = ['student@example.com', 'student1@example.com', 'student2@example.com'];
            let allRecords = [];

            studentUsernames.forEach(username => {
                const storageKey = `attendanceRecords_${username}`;
                const records = JSON.parse(localStorage.getItem(storageKey)) || [];

                const studentRecords = records.map(record => ({
                    ...record,
                    student: username
                }));

                allRecords = [...allRecords, ...studentRecords];
            });

            allRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            return allRecords;
        }

        // Update the loadAllStudentsAttendance function to use our new function
        function loadAllStudentsAttendance() {
            const teacherAttendanceBody = document.getElementById('teacherAttendanceBody');
            const noAttendanceData = document.getElementById('noAttendanceData');

            if (!teacherAttendanceBody || !noAttendanceData) return;

            const allRecords = getAllStudentsAttendanceRecords();

            if (allRecords.length > 0) {
                teacherAttendanceBody.innerHTML = '';
                noAttendanceData.style.display = 'none';

                allRecords.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${record.student}</td>
                <td>${record.date}</td>
                <td>${record.day}</td>
                <td>${record.time}</td>
                <td class="${record.status.toLowerCase()}">${record.status}</td>
            `;
                    teacherAttendanceBody.appendChild(row);
                });
            } else {
                teacherAttendanceBody.innerHTML = '';
                noAttendanceData.style.display = 'block';
            }
        }

        // Update the filterAttendanceByDate function
        function filterAttendanceByDate() {
            const dateInput = document.getElementById('attendanceDate');
            const teacherAttendanceBody = document.getElementById('teacherAttendanceBody');
            const noAttendanceData = document.getElementById('noAttendanceData');

            if (!dateInput || !teacherAttendanceBody || !noAttendanceData) return;

            const selectedDate = dateInput.value;

            if (!selectedDate) {
                alert('Please select a date to filter.');
                return;
            }

            const allRecords = getAllStudentsAttendanceRecords();
            const selectedDateObj = new Date(selectedDate);
            const selectedDateStr = selectedDateObj.toLocaleDateString();
            const filteredRecords = allRecords.filter(record => record.date === selectedDateStr);

            if (filteredRecords.length > 0) {
                teacherAttendanceBody.innerHTML = '';
                noAttendanceData.style.display = 'none';

                filteredRecords.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${record.student}</td>
                <td>${record.date}</td>
                <td>${record.day}</td>
                <td>${record.time}</td>
                <td class="${record.status.toLowerCase()}">${record.status}</td>
            `;
                    teacherAttendanceBody.appendChild(row);
                });
            } else {
                teacherAttendanceBody.innerHTML = '';
                noAttendanceData.style.display = 'block';
                noAttendanceData.textContent = `No attendance records found for ${selectedDateObj.toLocaleDateString()}.`;
            }
        }
  // Function to show assignment form for teachers
function showAssignmentForm() {
    const assignmentFormContainer = document.getElementById('assignmentFormContainer');
    if (!assignmentFormContainer) {
        console.error('Assignment form container not found');
        return;
    }

    assignmentFormContainer.innerHTML = `
<div class="form-container">
    <h3>Create New Assignment</h3>
    <form id="newAssignmentForm">
        <div class="form-group">
            <label for="assignmentCourse">Select Course:</label>
            <select id="assignmentCourse" required>
                <option value="">Select Course</option>
                <option value="Web Development">Web Development</option>
                <option value="Graphic Designing">Graphic Designing</option>
                <option value="E-commerce">E-commerce</option>
            </select>
        </div>
        <div class="form-group">
            <label for="assignmentTitle">Assignment Title:</label>
            <input type="text" id="assignmentTitle" required placeholder="Enter assignment title">
        </div>
        <div class="form-group">
            <label for="assignmentDescription">Description:</label>
            <textarea id="assignmentDescription" required placeholder="Enter assignment description"></textarea>
        </div>
        <div class="form-group">
            <label for="assignmentFile">Assignment File (Optional):</label>
            <input type="file" id="assignmentFile">
            <small>Upload instructions or supplementary materials</small>
        </div>
        <div class="form-group">
            <label for="assignmentDueDate">Due Date:</label>
            <input type="date" id="assignmentDueDate" required>
        </div>
        <button type="submit">Create Assignment</button>
        <button type="button" onclick="cancelAssignmentForm()">Cancel</button>
    </form>
</div>
`;

    // Add event listener to the form
    const newAssignmentForm = document.getElementById('newAssignmentForm');
    if (newAssignmentForm) {
        newAssignmentForm.addEventListener('submit', createNewAssignment);
    }
}

// Function to cancel assignment form
function cancelAssignmentForm() {
    const assignmentFormContainer = document.getElementById('assignmentFormContainer');
    if (assignmentFormContainer) {
        assignmentFormContainer.innerHTML = '';
    }
}

// Function to create a new assignment
function createNewAssignment(event) {
    event.preventDefault();

    const course = document.getElementById('assignmentCourse').value;
    const title = document.getElementById('assignmentTitle').value;
    const description = document.getElementById('assignmentDescription').value;
    const dueDate = document.getElementById('assignmentDueDate').value;
    const fileInput = document.getElementById('assignmentFile');

    if (!course || !title || !description || !dueDate) {
        alert('Please fill in all required fields.');
        return;
    }

    // Get teacher's username
    const teacherUsername = sessionStorage.getItem('currentUsername') || 'teacher@example.com';

    // Process file upload if provided
    let assignmentFileData = null;
    let assignmentFileName = null;

    if (fileInput && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        assignmentFileName = file.name;

        // Read file as data URL
        const reader = new FileReader();
        reader.onload = function (e) {
            const fileData = e.target.result;

            // Create assignment object with file data
            createAssignmentWithFile(course, title, description, dueDate, teacherUsername, assignmentFileName, fileData);
        };
        
        reader.onerror = function() {
            console.error('Error reading file');
            alert('Error uploading file. Please try again.');
        };

        reader.readAsDataURL(file);
    } else {
        // Create assignment without file
        createAssignmentWithFile(course, title, description, dueDate, teacherUsername, null, null);
    }
}

// Helper function to create assignment (with or without file)
function createAssignmentWithFile(course, title, description, dueDate, teacherUsername, fileName, fileData) {
    // Create assignment object
    const assignment = {
        id: Date.now().toString(),
        course,
        title,
        description,
        dueDate,
        createdBy: teacherUsername,
        createdOn: new Date().toISOString(),
        submissions: [],
        fileName: fileName,
        fileData: fileData
    };

    try {
        // Store assignment in localStorage
        const storageKey = 'assignments';
        const assignments = JSON.parse(localStorage.getItem(storageKey)) || [];
        assignments.push(assignment);
        localStorage.setItem(storageKey, JSON.stringify(assignments));

        // Clear the form
        cancelAssignmentForm();

        // Refresh the assignments list
        loadExistingAssignments();

        alert(`Assignment "${title}" for ${course} has been created successfully.`);
    } catch (error) {
        console.error('Error saving assignment:', error);
        alert('There was an error saving your assignment. Please try again.');
    }
}

// Function to load existing assignments for teacher
function loadExistingAssignments() {
    const assignmentsBody = document.getElementById('assignmentsBody');
    const noAssignmentsMessage = document.getElementById('noAssignmentsMessage');

    if (!assignmentsBody || !noAssignmentsMessage) {
        console.error('Assignment table elements not found');
        return;
    }

    try {
        // Get all assignments
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];

        if (assignments.length > 0) {
            assignmentsBody.innerHTML = '';
            noAssignmentsMessage.style.display = 'none';

            assignments.forEach(assignment => {
                const dueDate = new Date(assignment.dueDate).toLocaleDateString();
                const row = document.createElement('tr');

                // Check if due date is past
                const isDueDatePassed = new Date() > new Date(assignment.dueDate);

                // Count submissions
                const submissionCount = assignment.submissions ? assignment.submissions.length : 0;

                row.innerHTML = `
<td>${assignment.title} <span class="course-badge" style="display: inline-block; background: #e9f5ff; color: #0078d7; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-left: 5px;">${assignment.course}</span></td>
<td>${dueDate}</td>
<td>${submissionCount} submissions</td>
<td>
    <button onclick="viewAssignmentDetails('${assignment.id}')">View Details</button>
    <button onclick="viewSubmissions('${assignment.id}')">View Submissions</button>
    ${assignment.fileName ? `<button onclick="downloadAssignmentFile('${assignment.id}')">Download File</button>` : ''}
    ${isDueDatePassed ? `<button onclick="deleteAssignment('${assignment.id}')" class="delete-btn">Delete</button>` : ''}
</td>
`;

                assignmentsBody.appendChild(row);
            });
        } else {
            assignmentsBody.innerHTML = '';
            noAssignmentsMessage.style.display = 'block';
        }
    } catch (error) {
        console.error('Error loading assignments:', error);
        assignmentsBody.innerHTML = '<tr><td colspan="4">Error loading assignments. Please refresh the page.</td></tr>';
    }
}

// Function to download assignment file (teacher uploaded)
function downloadAssignmentFile(assignmentId) {
    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment || !assignment.fileData || !assignment.fileName) {
            alert('Assignment file not found.');
            return;
        }

        // Create download link
        const link = document.createElement('a');
        link.href = assignment.fileData;
        link.download = assignment.fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error('Error downloading file:', error);
        alert('Error downloading file. Please try again.');
    }
}

// Function to delete an assignment
function deleteAssignment(assignmentId) {
    if (!confirm('Are you sure you want to delete this assignment? This action cannot be undone.')) {
        return;
    }

    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const updatedAssignments = assignments.filter(a => a.id !== assignmentId);

        localStorage.setItem('assignments', JSON.stringify(updatedAssignments));

        // Refresh the assignments list
        loadExistingAssignments();

        alert('Assignment has been deleted successfully.');
    } catch (error) {
        console.error('Error deleting assignment:', error);
        alert('Error deleting assignment. Please try again.');
    }
}

// Function to view assignment details
function viewAssignmentDetails(assignmentId) {
    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment) {
            alert('Assignment not found.');
            return;
        }

        const dueDate = new Date(assignment.dueDate).toLocaleDateString();
        const hasFile = assignment.fileName ? `Yes (${assignment.fileName})` : 'No';

        alert(`
Assignment Details:

Title: ${assignment.title}
Course: ${assignment.course}
Description: ${assignment.description}
Due Date: ${dueDate}
Has File: ${hasFile}
Submissions: ${assignment.submissions ? assignment.submissions.length : 0}
`);
    } catch (error) {
        console.error('Error viewing assignment details:', error);
        alert('Error loading assignment details. Please try again.');
    }
}

// Function to view submissions for an assignment
function viewSubmissions(assignmentId) {
    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment) {
            alert('Assignment not found.');
            return;
        }

        const assignmentFormContainer = document.getElementById('assignmentFormContainer');
        if (!assignmentFormContainer) {
            console.error('Assignment form container not found');
            return;
        }

        if (!assignment.submissions || assignment.submissions.length === 0) {
            assignmentFormContainer.innerHTML = `
<div class="form-container">
    <h3>Submissions for "${assignment.title}"</h3>
    <p>No submissions yet.</p>
    <button onclick="cancelAssignmentForm()">Back</button>
</div>
`;
            return;
        }

        let submissionsHTML = `
<div class="form-container">
    <h3>Submissions for "${assignment.title}"</h3>
    <table>
        <thead>
            <tr>
                <th>Student</th>
                <th>Submitted On</th>
                <th>File</th>
                <th>Grade</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
`;

        assignment.submissions.forEach(submission => {
            const submittedDate = new Date(submission.submittedOn).toLocaleDateString();
            submissionsHTML += `
<tr>
    <td>${submission.student}</td>
    <td>${submittedDate}</td>
    <td>${submission.fileName}</td>
    <td>${submission.grade || 'Not graded'}</td>
    <td>
        <button onclick="gradeSubmission('${assignment.id}', '${submission.student}')">Grade</button>
        ${submission.fileData ? `<button onclick="downloadStudentSubmission('${assignment.id}', '${submission.student}')">Download</button>` : ''}
    </td>
</tr>
`;
        });

        submissionsHTML += `
        </tbody>
    </table>
    <button onclick="cancelAssignmentForm()" style="margin-top: 15px;">Back</button>
</div>
`;

        assignmentFormContainer.innerHTML = submissionsHTML;
    } catch (error) {
        console.error('Error viewing submissions:', error);
        alert('Error loading submissions. Please try again.');
    }
}

// Function to download student submission
function downloadStudentSubmission(assignmentId, student) {
    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment) {
            alert('Assignment not found.');
            return;
        }

        const submission = assignment.submissions.find(s => s.student === student);

        if (!submission || !submission.fileData || !submission.fileName) {
            alert('Submission file not found.');
            return;
        }

        // Create download link
        const link = document.createElement('a');
        link.href = submission.fileData;
        link.download = submission.fileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error('Error downloading submission:', error);
        alert('Error downloading submission. Please try again.');
    }
}

// Function to grade a submission
function gradeSubmission(assignmentId, student) {
    const grade = prompt('Enter grade for this submission (e.g., A, B, C, or a number):');

    if (grade === null) return; // User cancelled

    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignmentIndex = assignments.findIndex(a => a.id === assignmentId);

        if (assignmentIndex === -1) {
            alert('Assignment not found.');
            return;
        }

        const submissionIndex = assignments[assignmentIndex].submissions.findIndex(s => s.student === student);

        if (submissionIndex === -1) {
            alert('Submission not found.');
            return;
        }

        // Update the grade
        assignments[assignmentIndex].submissions[submissionIndex].grade = grade;
        localStorage.setItem('assignments', JSON.stringify(assignments));

        // Refresh the view
        viewSubmissions(assignmentId);

        alert(`Submission graded successfully.`);
    } catch (error) {
        console.error('Error grading submission:', error);
        alert('Error saving grade. Please try again.');
    }
}

// Function to update the student dashboard to handle assignments
function updateStudentAssignmentsSection() {
    const assignmentsSection = document.getElementById('assignments');
    if (!assignmentsSection) {
        console.error('Assignments section not found');
        return;
    }

    // Check if course select already exists to avoid duplicates
    if (document.getElementById('studentCourseSelect')) {
        return; // Already initialized
    }

    // Add course selection dropdown
    const courseSelectHTML = `
<div class="form-group">
    <label for="studentCourseSelect">Select Course:</label>
    <select id="studentCourseSelect" class="form-group mb-3">
        <option value="">Select Course</option>
        <option value="Web Development">Web Development</option>
        <option value="Graphic Designing">Graphic Designing</option>
        <option value="E-commerce">E-commerce</option>
    </select>
</div>
<div id="courseAssignments"></div>
`;

    // Insert the course select at the beginning of the assignments section
    assignmentsSection.insertAdjacentHTML('afterbegin', courseSelectHTML);

    // Add event listener to the course select dropdown
    const studentCourseSelect = document.getElementById('studentCourseSelect');
    if (studentCourseSelect) {
        studentCourseSelect.addEventListener('change', loadStudentAssignments);
    }
}

// Function to load assignments for a student based on selected course
function loadStudentAssignments() {
    const selectedCourse = document.getElementById('studentCourseSelect')?.value;
    const courseAssignmentsDiv = document.getElementById('courseAssignments');

    if (!selectedCourse || !courseAssignmentsDiv) {
        console.error('Course select or assignments div not found');
        return;
    }

    try {
        // Get all assignments
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];

        // Filter assignments by selected course
        const courseAssignments = assignments.filter(a => a.course === selectedCourse);

        if (courseAssignments.length === 0) {
            courseAssignmentsDiv.innerHTML = '<p>No assignments available for this course.</p>';
            return;
        }

        let assignmentsHTML = `
<h3>Assignments for ${selectedCourse}</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Due Date</th>
            <th>Status</th>
            <th>Grade</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
`;

        const studentUsername = sessionStorage.getItem('currentUsername') || 'student@example.com';

        courseAssignments.forEach(assignment => {
            const dueDate = new Date(assignment.dueDate).toLocaleDateString();

            // Check if student has already submitted this assignment
            const studentSubmission = assignment.submissions ?
                assignment.submissions.find(s => s.student === studentUsername) : null;

            const status = studentSubmission ? 'Submitted' : 'Not Submitted';
            const grade = studentSubmission && studentSubmission.grade ? studentSubmission.grade : 'Not graded';

            assignmentsHTML += `
<tr>
    <td>${assignment.title}</td>
    <td>${dueDate}</td>
    <td>${status}</td>
    <td>${grade}</td>
    <td>
        <button onclick="viewAssignmentDetailsStudent('${assignment.id}')">View</button>
        ${assignment.fileName ? `<button onclick="downloadAssignmentFile('${assignment.id}')">Download Instructions</button>` : ''}
        ${!studentSubmission ?
            `<button onclick="showSubmitAssignmentForm('${assignment.id}')">Submit</button>` :
            ''}
    </td>
</tr>
`;
        });

        assignmentsHTML += `
    </tbody>
</table>
`;

        courseAssignmentsDiv.innerHTML = assignmentsHTML;
    } catch (error) {
        console.error('Error loading student assignments:', error);
        courseAssignmentsDiv.innerHTML = '<p>Error loading assignments. Please refresh the page.</p>';
    }
}

// Function to view assignment details for students
function viewAssignmentDetailsStudent(assignmentId) {
    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment) {
            alert('Assignment not found.');
            return;
        }

        const dueDate = new Date(assignment.dueDate).toLocaleDateString();
        const hasFile = assignment.fileName ? `Yes (${assignment.fileName})` : 'No';

        alert(`
Assignment Details:

Title: ${assignment.title}
Course: ${assignment.course}
Description: ${assignment.description}
Due Date: ${dueDate}
Instructions File: ${hasFile}
`);
    } catch (error) {
        console.error('Error viewing assignment details:', error);
        alert('Error loading assignment details. Please try again.');
    }
}

// Function to show submit assignment form
function showSubmitAssignmentForm(assignmentId) {
    const courseAssignmentsDiv = document.getElementById('courseAssignments');
    if (!courseAssignmentsDiv) {
        console.error('Course assignments div not found');
        return;
    }

    try {
        const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
        const assignment = assignments.find(a => a.id === assignmentId);

        if (!assignment) {
            alert('Assignment not found.');
            return;
        }

        const submitFormHTML = `
<div class="form-container">
    <h3>Submit Assignment: ${assignment.title}</h3>
    <form id="submitAssignmentForm">
        <input type="hidden" id="submissionAssignmentId" value="${assignmentId}">
        <div class="form-group">
            <label for="submissionFile">Upload Your Assignment:</label>
            <input type="file" id="submissionFile" required>
        </div>
        <div class="form-group">
            <label for="submissionComments">Comments (Optional):</label>
            <textarea id="submissionComments" placeholder="Any comments about your submission"></textarea>
        </div>
        <button type="submit">Submit Assignment</button>
        <button type="button" onclick="loadStudentAssignments()">Cancel</button>
    </form>
</div>
`;

        courseAssignmentsDiv.innerHTML = submitFormHTML;

        // Add event listener to the form
        const submitAssignmentForm = document.getElementById('submitAssignmentForm');
        if (submitAssignmentForm) {
            submitAssignmentForm.addEventListener('submit', submitStudentAssignment);
        }
    } catch (error) {
        console.error('Error showing submission form:', error);
        alert('Error loading submission form. Please try again.');
    }
}

// Function to submit student assignment
function submitStudentAssignment(event) {
    event.preventDefault();

    const assignmentId = document.getElementById('submissionAssignmentId').value;
    const fileInput = document.getElementById('submissionFile');
    const comments = document.getElementById('submissionComments').value;

    if (!fileInput || !fileInput.files.length) {
        alert('Please select a file to upload.');
        return;
    }

    try {
        const file = fileInput.files[0];
        const fileName = file.name;
        const studentUsername = sessionStorage.getItem('currentUsername') || 'student@example.com';

        // Read file as data URL
        const reader = new FileReader();
        reader.onload = function (e) {
            const fileData = e.target.result;

            // Create submission object with file data
            const submission = {
                student: studentUsername,
                fileName,
                comments,
                submittedOn: new Date().toISOString(),
                fileData: fileData
            };

            // Update the assignment in localStorage
            const assignments = JSON.parse(localStorage.getItem('assignments')) || [];
            const assignmentIndex = assignments.findIndex(a => a.id === assignmentId);

            if (assignmentIndex === -1) {
                alert('Assignment not found.');
                return;
            }

            if (!assignments[assignmentIndex].submissions) {
                assignments[assignmentIndex].submissions = [];
            }

            assignments[assignmentIndex].submissions.push(submission);
            localStorage.setItem('assignments', JSON.stringify(assignments));

            // Reload the assignments list
            loadStudentAssignments();

            alert(`Assignment "${assignments[assignmentIndex].title}" submitted successfully.`);
        };

        reader.onerror = function() {
            console.error('Error reading file');
            alert('Error uploading file. Please try again.');
        };

        reader.readAsDataURL(file);
    } catch (error) {
        console.error('Error submitting assignment:', error);
        alert('Error submitting assignment. Please try again.');
    }
}

// Initialize the assignment functionality when the page loads
document.addEventListener('DOMContentLoaded', function () {
    try {
        // Check if we're on the student dashboard
        if (document.getElementById('assignments')) {
            // Update the student assignments section
            updateStudentAssignmentsSection();
        }

        // Check if we're on the teacher dashboard
        const createAssignmentBtn = document.getElementById('createAssignment');
        if (createAssignmentBtn) {
            createAssignmentBtn.addEventListener('click', showAssignmentForm);
            
            // Load existing assignments if we're on the teacher dashboard
            if (document.getElementById('assignmentsBody')) {
                loadExistingAssignments();
            }
        }
    } catch (error) {
        console.error('Error initializing assignment functionality:', error);
    }
});
        // teacher lecture upload
        // Function to upload lecture
        function uploadLecture(event) {
            event.preventDefault();

            const lectureCourse = document.getElementById('lectureCourse').value;
            const lectureTitle = document.getElementById('lectureTitle').value;
            const lectureDescription = document.getElementById('lectureDescription').value;
            const lectureFile = document.getElementById('lectureFile');
            const lectureUploadStatus = document.getElementById('lectureUploadStatus');

            if (!lectureCourse || !lectureTitle || !lectureFile.files.length) {
                alert('Please select a course, enter a title, and upload a file.');
                return;
            }

            const file = lectureFile.files[0];
            const fileName = file.name;

            // Read file as data URL
            const reader = new FileReader();
            reader.onload = function (e) {
                const fileData = e.target.result;

                // Create lecture object
                const lecture = {
                    id: Date.now().toString(),
                    title: lectureTitle,
                    description: lectureDescription,
                    course: lectureCourse,
                    fileName: fileName,
                    fileData: fileData,
                    uploadedBy: sessionStorage.getItem('currentUsername') || 'teacher@example.com',
                    uploadedOn: new Date().toISOString()
                };

                // Store lecture in localStorage
                const storageKey = 'lectures';
                const lectures = JSON.parse(localStorage.getItem(storageKey)) || [];
                lectures.push(lecture);
                localStorage.setItem(storageKey, JSON.stringify(lectures));

                // Update status
                if (lectureUploadStatus) {
                    lectureUploadStatus.textContent = `Lecture "${lectureTitle}" for ${lectureCourse} uploaded successfully.`;
                    setTimeout(() => {
                        lectureUploadStatus.textContent = '';
                    }, 3000);
                }

                // Reset form
                document.getElementById('lectureUploadForm').reset();

                // Refresh the lectures list
                loadUploadedLectures();
            };

            reader.readAsDataURL(file);
        }

        // Function to load uploaded lectures for teacher
        function loadUploadedLectures() {
            const lectureList = document.getElementById('lectureList');
            if (!lectureList) return;

            const lectures = JSON.parse(localStorage.getItem('lectures')) || [];
            const teacherUsername = sessionStorage.getItem('currentUsername') || 'teacher@example.com';

            // Filter lectures uploaded by the current teacher
            const teacherLectures = lectures.filter(lecture => lecture.uploadedBy === teacherUsername);

            if (teacherLectures.length === 0) {
                lectureList.innerHTML = '<li class="empty-message">No lectures uploaded yet.</li>';
                return;
            }

            // Sort lectures by upload date (newest first)
            teacherLectures.sort((a, b) => new Date(b.uploadedOn) - new Date(a.uploadedOn));

            lectureList.innerHTML = '';
            teacherLectures.forEach(lecture => {
                const uploadDate = new Date(lecture.uploadedOn).toLocaleDateString();
                const li = document.createElement('li');
                li.style.padding = '10px';
                li.style.margin = '10px 0';
                li.style.backgroundColor = '#f9f9f9';
                li.style.borderRadius = '5px';
                li.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';

                li.innerHTML = `
    <strong>${lecture.title}</strong> 
    <span class="course-badge" style="display: inline-block; background: #e9f5ff; color: #0078d7; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-left: 5px;">${lecture.course}</span>
    <p>${lecture.description || 'No description provided.'}</p>
    <p><small>File: ${lecture.fileName} (Uploaded on ${uploadDate})</small></p>
    <button onclick="downloadLecture('${lecture.id}')">Download</button>
    <button onclick="deleteLecture('${lecture.id}')">Delete</button>
`;

                lectureList.appendChild(li);
            });
        }

        // Function to download lecture
        function downloadLecture(lectureId) {
            const lectures = JSON.parse(localStorage.getItem('lectures')) || [];
            const lecture = lectures.find(l => l.id === lectureId);

            if (!lecture || !lecture.fileData) {
                alert('Lecture file not found.');
                return;
            }

            // Create download link
            const link = document.createElement('a');
            link.href = lecture.fileData;
            link.download = lecture.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Function to delete lecture
        function deleteLecture(lectureId) {
            if (!confirm('Are you sure you want to delete this lecture?')) return;

            const lectures = JSON.parse(localStorage.getItem('lectures')) || [];
            const updatedLectures = lectures.filter(l => l.id !== lectureId);

            localStorage.setItem('lectures', JSON.stringify(updatedLectures));

            // Refresh the lectures list
            loadUploadedLectures();

            alert('Lecture deleted successfully.');
        }
        // student lecture
        // Function to load lectures for student based on selected course
        function loadStudentLectures() {
            const selectedCourse = document.getElementById('studentLectureCourseSelect').value;
            const lecturesContainer = document.getElementById('studentLecturesList');

            if (!selectedCourse || !lecturesContainer) return;

            // Get all lectures
            const lectures = JSON.parse(localStorage.getItem('lectures')) || [];

            // Filter lectures by selected course
            const courseLectures = lectures.filter(l => l.course === selectedCourse);

            if (courseLectures.length === 0) {
                lecturesContainer.innerHTML = '<p class="empty-message">No lectures available for this course.</p>';
                return;
            }

            // Sort lectures by upload date (newest first)
            courseLectures.sort((a, b) => new Date(b.uploadedOn) - new Date(a.uploadedOn));

            lecturesContainer.innerHTML = '';
            courseLectures.forEach(lecture => {
                const uploadDate = new Date(lecture.uploadedOn).toLocaleDateString();
                const div = document.createElement('div');
                div.className = 'lecture-item';
                div.style.padding = '15px';
                div.style.margin = '10px 0';
                div.style.backgroundColor = '#f9f9f9';
                div.style.borderRadius = '8px';
                div.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';

                div.innerHTML = `
    <h3>${lecture.title}</h3>
    <p>${lecture.description || 'No description provided.'}</p>
    <p><small>File: ${lecture.fileName} (Uploaded on ${uploadDate})</small></p>
    <button onclick="downloadStudentLecture('${lecture.id}')">Download Lecture</button>
`;

                lecturesContainer.appendChild(div);
            });
        }

        // Function for student to download lecture
        function downloadStudentLecture(lectureId) {
            const lectures = JSON.parse(localStorage.getItem('lectures')) || [];
            const lecture = lectures.find(l => l.id === lectureId);

            if (!lecture || !lecture.fileData) {
                alert('Lecture file not found.');
                return;
            }

            // Create download link
            const link = document.createElement('a');
            link.href = lecture.fileData;
            link.download = lecture.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        // Initialize the lecture functionality when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            // Teacher lecture upload form
            const lectureUploadForm = document.getElementById('lectureUploadForm');
            if (lectureUploadForm) {
                lectureUploadForm.addEventListener('submit', uploadLecture);
            }

            // Student lecture course selection
            const studentLectureCourseSelect = document.getElementById('studentLectureCourseSelect');
            if (studentLectureCourseSelect) {
                studentLectureCourseSelect.addEventListener('change', loadStudentLectures);
            }

            // Load lectures when sections are shown
            const currentUserType = sessionStorage.getItem('currentUserType'); // Fixed: removed space in key name
            if (currentUserType === "ClassTeacher") {
                // Load teacher's uploaded lectures when the section is shown
                const teacherLecturesBtn = document.querySelector('.sidebar button[onclick="showSection(\'lectures\')"]');
                if (teacherLecturesBtn) {
                    teacherLecturesBtn.addEventListener('click', loadUploadedLectures);
                }
            } else if (currentUserType === "Student") {
                // Add event listener for student uploaded lectures section
                const uploadedLecturesBtn = document.querySelector('.sidebar button[onclick="showSection(\'uploadedLectures\')"]');
                if (uploadedLecturesBtn) {
                    uploadedLecturesBtn.addEventListener('click', function () {
                        // Reset the course selection when the section is shown
                        const studentLectureCourseSelect = document.getElementById('studentLectureCourseSelect');
                        if (studentLectureCourseSelect) {
                            studentLectureCourseSelect.value = '';
                            document.getElementById('studentLecturesList').innerHTML = '<p>Please select a course to view lectures.</p>';
                        }
                    });
                }
            }
        });
    });


</script>

</html>
